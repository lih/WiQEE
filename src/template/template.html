<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"$if(lang)$ lang="$lang$" xml:lang="$lang$"$endif$>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
$for(author-meta)$
  <meta name="author" content="$author-meta$" />
$endfor$
$if(date-meta)$
  <meta name="date" content="$date-meta$" />
$endif$
  <title>$if(title-prefix)$$title-prefix$ - $endif$$pagetitle$</title>
  <style type="text/css">
    code{white-space: pre;}
    #capricon-prelude { display: none; }
    .capricon-output { display: inline-block; }
    #content-scroll::after {
	content: "";
	position: absolute;
	left: 0; top: 0; bottom: 0; right: 0;
	opacity: 0.45;
	z-index: -1;
	background-image: url($noise-image-url$); }
    .capricon-hide + .capricon-hidestache::before {
	content: "";
	width: 0.5em; height: 0.5em; display: inline-block;
	position: relative; bottom: 0.3em;
	background: url($steps-image-url$);
	background-size: 100% 100%;
	background-repeat: none;
	padding: 0.2em;
	border: 1px solid rgba(255,255,255,0);
    }
  </style>
  <noscript>
    <style>.interactive { display: none !important; }</style>
  </noscript>
$if(quotes)$
  <style type="text/css">q { quotes: "“" "”" "‘" "’"; }</style>
$endif$
$if(highlighting-css)$
  <style type="text/css">
    $highlighting-css$
  </style>
$endif$
$for(css)$
  <link rel="stylesheet" href="$css$" $if(html5)$$else$type="text/css" $endif$/>
$endfor$
$if(math)$
  $math$
$endif$
$for(header-includes)$
  $header-includes$
$endfor$
</head>
<body>
$for(include-before)$
$include-before$
$endfor$
<nav class="nav">
  <ul>
    <li id="nav-head"><a href="index.html">WiQEE</a><ul>
	<li><a href="lexicon.html">Lexicon</a></li>
    </ul></li><li id="nav-title"><a class="#">$title$</a>
      $if(toc)$
      $toc$
      $endif$
    </li><li id="page-source"><a href="$module$.md">Page source</a></li>
  </ul>
</nav>
<div id="content-frame"><div id="content-scroll" autofocus="autofocus"><div id="content">
$body$
<div id="footer">
  Page generated on $full-date$, using capricon-$capricon-version$ and pandoc-$pandoc-version$.
</div>
</div></div></div>
$if(prelude-text)$
<div id="capricon-prelude" style="display: none;">$prelude-text$</div>
$endif$
<div id="capricon-console"></div>
<script type="text/javascript">
  capriconWorker = new Worker('WiQEE-worker.js');

  workerCallbacks = [];
  capriconWorker.onmessage = function (e) {
      var callback = workerCallbacks[e.data[0]];
      callback(e.data[1]);
  };

  function runCaPriCon(state,code,then) {
      var nextCallback = workerCallbacks.length;
      workerCallbacks.push(then);
      capriconWorker.postMessage([0,nextCallback,state,code]);
  };
  function evalCaPriCon(state,code,then) {
      var nextCallback = workerCallbacks.length;
      workerCallbacks.push(then);
      capriconWorker.postMessage([1,nextCallback,state,code]);
  };

  prel = document.getElementById('capricon-prelude').textContent;
  roots = Array.prototype.slice.call(document.getElementsByClassName('capricon-steps'));
  console = document.getElementById('capricon-console');
  function loop0(i) { return function (st) {
      // alert('loop0 called with '+i+' roots.length='+roots.length);
      if(i < roots.length) {
      	  var root = roots[i];
	  if(root.tagName == 'CODE') {
	      runCaPriCon(st,root.textContent + " mustache.",loop0(i+1));
	  }
	  else {
	      var mainInput = root.getElementsByClassName('capricon-input')[0];
	      mainInput.classList.add('pending');

	      var consoleRoot = root.cloneNode(true);
	      var consoleTitle = document.createElement('h3');
	      var consoleClose = document.createElement('button');
	      
	      var mainExamples = root.getElementsByClassName('capricon-example');
	      for(var j = 0; j < mainExamples.length; j++) {
		  (function () {
		      var example = mainExamples[j];
		      example.addEventListener('click', function (ev) {
			  mainInput.value = example.getAttribute('data-code');
		      });
		  })();
	      }

	      consoleClose.textContent = "Close";
	      consoleClose.addEventListener('click', function() {
		  consoleRoot.classList.remove('active');
		  mainInput.value = consoleInput.value;
	      });
	      consoleTitle.textContent = "CaPriCon Console";
	      consoleTitle.appendChild(consoleClose);
	      consoleRoot.insertBefore(consoleTitle,consoleRoot.firstChild);
	      console.appendChild(consoleRoot);


	      var text = root.getElementsByClassName('capricon')[0].textContent;
	      runCaPriCon(st,text,function(st0) {
		  var mainTrigger = root.getElementsByClassName('capricon-trigger')[0];
		  var consoleInput = consoleRoot.getElementsByClassName('capricon-input')[0];
		  var consoleOutput = consoleRoot.getElementsByClassName('capricon-output')[0];
		  
		  mainInput.classList.add('ready'); mainInput.classList.remove('pending');
		  mainTrigger.addEventListener('click', function (ev) {
		      if(!consoleRoot.classList.contains('active')) {
			  consoleRoot.classList.add('active');
			  consoleInput.value = mainInput.value;
			  evalCaPriCon(st0,consoleInput.value,function(ret) { consoleOutput.textContent = ret; });
		      	  consoleInput.focus();
		      }
		  });

		  consoleInput.addEventListener('keypress', function (ev) {
		      if(ev.keyCode == 13) { // Press Enter
			  evalCaPriCon(st0,consoleInput.value,function(ret) { consoleOutput.textContent = ret; });
		      }
		  });
		  
		  mainInput.addEventListener('keypress', function (ev) {
		      if(ev.keyCode == 13) { // Press Enter
			  consoleRoot.classList.add('active');
			  consoleInput.value = mainInput.value;
			  evalCaPriCon(st0,mainInput.value,function(ret) { consoleOutput.textContent = ret; });
			  consoleInput.focus();
		      }
		  });

		  loop0(i+1)(st0);
	      });
	  }
      }
  };}
  runCaPriCon(0,prel,loop0(0));

  window.addEventListener("load",function() {
      var formulae = document.getElementsByClassName('formula');
      for(var i in formulae) {
	  var formula = formulae[i];
	  var box = formula.getBBox();
	  var w = Math.ceil(box.width)*1.05; h = Math.ceil(box.height)*1.05;
	  var x = Math.floor(box.x), y = Math.floor(box.y);
	  
	  formula.setAttribute("viewBox", x+" "+y+" "+w+" "+h);
	  formula.setAttribute("width", w);
	  formula.setAttribute("height", h);
      }
  });
</script>
$for(include-after)$
$include-after$
$endfor$
</body>
</html>
